# å­˜æ¡£ç³»ç»Ÿæ“ä½œæŒ‡å—

## ğŸ“š ä¸¤ä¸ªç»„çš„åŒºåˆ«å’Œç”¨é€”

### ç»„1: `save_level_data_manager`

**ç”¨é€”**: æ‰¾åˆ°**å…³å¡å­˜æ¡£ç®¡ç†å™¨**ï¼ˆæ¯ä¸ªåœºæ™¯åªæœ‰ä¸€ä¸ªï¼‰

**è°ä½¿ç”¨å®ƒ**:
- `SaveLevelDataComponent` åŠ å…¥æ­¤ç»„
- `SaveGameManager` æŸ¥æ‰¾æ­¤ç»„

**ä½œç”¨**: 
- è¿™æ˜¯å­˜æ¡£ç³»ç»Ÿçš„"å…¥å£"
- `SaveGameManager` é€šè¿‡è¿™ä¸ªç»„æ‰¾åˆ°å½“å‰åœºæ™¯çš„å­˜æ¡£ç®¡ç†å™¨
- ç„¶åè°ƒç”¨ `save_game()` æˆ– `load_game()`

### ç»„2: `save_data_component`

**ç”¨é€”**: æ”¶é›†**æ‰€æœ‰éœ€è¦ä¿å­˜çš„èŠ‚ç‚¹**ï¼ˆæ¯ä¸ªè¦ä¿å­˜çš„å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªï¼‰

**è°ä½¿ç”¨å®ƒ**:
- `SaveDataComponent` åŠ å…¥æ­¤ç»„
- `SaveLevelDataComponent` æŸ¥æ‰¾æ­¤ç»„

**ä½œç”¨**:
- ä¿å­˜æ—¶ï¼Œéå†æ­¤ç»„ä¸­çš„æ‰€æœ‰ç»„ä»¶
- è®©æ¯ä¸ªç»„ä»¶æ”¶é›†è‡ªå·±çš„æ•°æ®
- æ±‡æ€»åˆ°ä¸€ä¸ªå­˜æ¡£æ–‡ä»¶ä¸­

---

## ğŸ”„ ç³»ç»Ÿå·¥ä½œæµç¨‹

### ä¿å­˜æµç¨‹

```
[è§¦å‘ä¿å­˜] ç©å®¶æŒ‰ä¿å­˜é”® / ç³»ç»Ÿè§¦å‘
    â†“
SaveGameManager.save_game()
    â†“
æŸ¥æ‰¾ "save_level_data_manager" ç»„
    â†“
è·å– SaveLevelDataComponent
    â†“
è°ƒç”¨ save_level_data_component.save_game()
    â†“
æŸ¥æ‰¾ "save_data_component" ç»„
    â†“
éå†æ‰€æœ‰ SaveDataComponent
    â†“
æ¯ä¸ªç»„ä»¶è°ƒç”¨ _save_data() æ”¶é›†æ•°æ®
    â†“
æ±‡æ€»åˆ° SaveGameDataResource
    â†“
ä¿å­˜åˆ°æ–‡ä»¶ user://game_data/save_åœºæ™¯å_game_data.tres
```

### åŠ è½½æµç¨‹

```
[è§¦å‘åŠ è½½] ç©å®¶é€‰æ‹©è¯»æ¡£
    â†“
SaveGameManager.load_game()
    â†“
æŸ¥æ‰¾ "save_level_data_manager" ç»„
    â†“
è·å– SaveLevelDataComponent
    â†“
è°ƒç”¨ save_level_data_component.load_game()
    â†“
è¯»å–å­˜æ¡£æ–‡ä»¶
    â†“
éå†å­˜æ¡£ä¸­çš„æ•°æ®
    â†“
æ¢å¤æ¯ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€
```

---

## ğŸ¯ ä½¿ç”¨æ­¥éª¤

### æ­¥éª¤1: åœ¨åœºæ™¯ä¸­æ·»åŠ  SaveLevelDataComponentï¼ˆå¿…é¡»ï¼ï¼‰

**è¿™æ˜¯æœ€é‡è¦çš„æ­¥éª¤ï¼Œæ²¡æœ‰å®ƒå­˜æ¡£ç³»ç»Ÿæ— æ³•å·¥ä½œï¼**

**æ“ä½œ**:
1. æ‰“å¼€ä½ çš„åœºæ™¯æ–‡ä»¶ï¼ˆå¦‚ `test_scene_save_data.tscn`ï¼‰
2. åœ¨åœºæ™¯æ ¹èŠ‚ç‚¹ä¸Šå³é”®
3. é€‰æ‹© "å®ä¾‹åŒ–å­åœºæ™¯"
4. é€‰æ‹© `save_level_data_component.tscn`
5. ç¡®ä¿å®ƒè¢«æ·»åŠ åˆ°åœºæ™¯æ ¹èŠ‚ç‚¹ä¸‹

**ç»“æœ**: åœºæ™¯ä¸­åº”è¯¥æœ‰è¿™ä¸ªç»“æ„:
```
TestSceneCrop (æ ¹èŠ‚ç‚¹)
â”œâ”€â”€ SaveLevelDataComponent    â† å¿…é¡»æœ‰ï¼
â”œâ”€â”€ SaveDataComponent         â† å¯é€‰ï¼Œå–å†³äºä½ è¦ä¿å­˜ä»€ä¹ˆ
â”œâ”€â”€ player
â””â”€â”€ ...å…¶ä»–èŠ‚ç‚¹
```

### æ­¥éª¤2: ä¸ºéœ€è¦ä¿å­˜çš„èŠ‚ç‚¹æ·»åŠ  SaveDataComponent

**ä»€ä¹ˆèŠ‚ç‚¹éœ€è¦ä¿å­˜ï¼Ÿ**
- ç©å®¶ä½ç½® â†’ ç»™ player æ·»åŠ 
- ä½œç‰©çŠ¶æ€ â†’ ç»™ä½œç‰©æ·»åŠ 
- åœ°å›¾ä¿®æ”¹ â†’ ç»™ TileMapLayer æ·»åŠ 
- NPCçŠ¶æ€ â†’ ç»™NPCæ·»åŠ 

**æ“ä½œ**:
1. é€‰æ‹©è¦ä¿å­˜çš„èŠ‚ç‚¹
2. å³é”® â†’ "æ·»åŠ å­èŠ‚ç‚¹"
3. å®ä¾‹åŒ– `save_data_component.tscn`
4. åœ¨æ£€æŸ¥å™¨ä¸­è®¾ç½® `save_data_resource`:
   - ç©å®¶/åŠ¨æ€å¯¹è±¡ â†’ æ‹–æ‹½ `scene_data_resource.tres`
   - åœ°å›¾å±‚ â†’ æ‹–æ‹½ `tilemap_layer_data_resource.tres`

### æ­¥éª¤3: è§¦å‘ä¿å­˜

**æ–¹å¼A: ç©å®¶æ‰‹åŠ¨è§¦å‘**ï¼ˆåœ¨å½“å‰ä»£ç ä¸­ï¼‰
```gdscript
# åœ¨ player.gd ä¸­
if event.is_action_pressed("save_game"):
    SaveGameManager.save_game()
```

**æ–¹å¼B: ç³»ç»Ÿè‡ªåŠ¨è§¦å‘**ï¼ˆå‰§æƒ…å­˜æ¡£ï¼‰
```gdscript
# åœ¨å‰§æƒ…èŠ‚ç‚¹è°ƒç”¨
SaveGameManager.save_game()
```

### æ­¥éª¤4: è§¦å‘åŠ è½½

```gdscript
# åœ¨ç©å®¶é€‰æ‹©è¯»æ¡£å
SaveGameManager.load_game()
```

---

## ğŸ› å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜1: "æ‰¾ä¸åˆ° save_level_data_manager ç»„"

**åŸå› **: åœºæ™¯ä¸­æ²¡æœ‰æ”¾ç½® SaveLevelDataComponent

**è§£å†³**: 
```
æ£€æŸ¥åœºæ™¯æ˜¯å¦åŒ…å«:
â””â”€â”€ SaveLevelDataComponent (å®ä¾‹åŒ–è‡ª save_level_data_component.tscn)
```

### é—®é¢˜2: "ä¿å­˜æˆåŠŸä½†æ–‡ä»¶ä¸ºç©º"

**åŸå› **: æ²¡æœ‰ç»™ SaveDataComponent è®¾ç½® save_data_resource

**è§£å†³**:
1. é€‰æ‹© SaveDataComponent èŠ‚ç‚¹
2. åœ¨æ£€æŸ¥å™¨ä¸­æ‰¾åˆ° save_data_resource
3. æ‹–æ‹½å¯¹åº”çš„ .tres æ–‡ä»¶:
   - æ™®é€šèŠ‚ç‚¹ â†’ scene_data_resource.tres
   - TileMapLayer â†’ tilemap_layer_data_resource.tres

### é—®é¢˜3: "åŠ è½½åå¯¹è±¡ä½ç½®ä¸å¯¹"

**åŸå› **: SceneDataResource._load_data() ä¸­çš„ parent_node_path å¯èƒ½ä¸æ­£ç¡®

**è§£å†³**: 
- æ£€æŸ¥ä¿å­˜æ—¶çš„èŠ‚ç‚¹è·¯å¾„
- ç¡®ä¿åŠ è½½æ—¶åœºæ™¯ç»“æ„ä¸€è‡´

### é—®é¢˜4: "å­˜æ¡£æ–‡ä»¶å†²çª"

**åŸå› **: å¤šä¸ªåœºæ™¯ä½¿ç”¨ç›¸åŒçš„å­˜æ¡£æ–‡ä»¶å

**è§£å†³**: 
- æ¯ä¸ªåœºæ™¯çš„ SaveLevelDataComponent çš„çˆ¶èŠ‚ç‚¹åè¦å”¯ä¸€
- æˆ–è€…ä¿®æ”¹ save_level_data_component.gd ä¸­çš„æ–‡ä»¶åç”Ÿæˆé€»è¾‘

---

## ğŸ“ å…³é”®æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶ | ä½œç”¨ | æ˜¯å¦éœ€è¦ä¿®æ”¹ |
|------|------|-------------|
| `save_game_manager.gd` | å…¨å±€å…¥å£ï¼Œæä¾› save_game() / load_game() | âŒ ä¸€èˆ¬ä¸æ”¹ |
| `save_level_data_component.gd` | å…³å¡çº§ç®¡ç†ï¼Œæ”¶é›†å’Œä¿å­˜æ•°æ® | âš ï¸ æ–‡ä»¶åæ ¼å¼å¯æ”¹ |
| `save_data_component.gd` | èŠ‚ç‚¹çº§æ ‡è®°ï¼Œæ”¶é›†å•ä¸ªèŠ‚ç‚¹æ•°æ® | âŒ ä¸€èˆ¬ä¸æ”¹ |
| `node_data_resource.gd` | åŸºç¡€æ•°æ®ç±»ï¼ˆä½ç½®ã€è·¯å¾„ï¼‰ | âŒ ä¸æ”¹ |
| `scene_data_resource.gd` | åœºæ™¯å¯¹è±¡æ•°æ®ï¼ˆç©å®¶ã€NPCç­‰ï¼‰ | âš ï¸ å¯æ‰©å±• |
| `tilemap_layer_data_resource.gd` | åœ°å›¾å±‚æ•°æ®ï¼ˆè€•åœ°ç­‰ï¼‰ | âŒ ä¸æ”¹ |
| `save_game_data_resource.gd` | å­˜æ¡£å®¹å™¨ï¼Œèšåˆæ‰€æœ‰æ•°æ® | âŒ ä¸æ”¹ |

---

## ğŸ’¡ æœ€ä½³å®è·µ

1. **æ¯ä¸ªåœºæ™¯å¿…é¡»æœ‰ SaveLevelDataComponent**
   - æ”¾åœ¨åœºæ™¯æ ¹èŠ‚ç‚¹ä¸‹
   - ä¸€ä¸ªåœºæ™¯ä¸€ä¸ªï¼Œä¸è¦å¤šä¹Ÿä¸è¦å°‘

2. **ä¸æ˜¯æ‰€æœ‰èŠ‚ç‚¹éƒ½éœ€è¦ SaveDataComponent**
   - åªç»™éœ€è¦ä¿å­˜çŠ¶æ€çš„èŠ‚ç‚¹æ·»åŠ 
   - é™æ€ç‰©ä½“ï¼ˆå¦‚æˆ¿å±‹ã€åœ°å½¢ï¼‰ä¸éœ€è¦

3. **å­˜æ¡£æ–‡ä»¶åç®¡ç†**
   - é»˜è®¤ä½¿ç”¨åœºæ™¯åï¼š`save_{åœºæ™¯å}_game_data.tres`
   - ç¡®ä¿åœºæ™¯åå”¯ä¸€ï¼Œé¿å…å†²çª

4. **æµ‹è¯•å­˜æ¡£**
   - å…ˆæµ‹è¯•ä¿å­˜æ˜¯å¦ç”Ÿæˆæ–‡ä»¶
   - å†æµ‹è¯•åŠ è½½æ˜¯å¦èƒ½æ¢å¤çŠ¶æ€
   - æ£€æŸ¥ user://game_data/ ç›®å½•ä¸‹çš„æ–‡ä»¶

5. **å¤‡ä»½å­˜æ¡£**
   - å¼€å‘æ—¶å®šæœŸå¤‡ä»½å­˜æ¡£æ–‡ä»¶
   - å­˜æ¡£æ ¼å¼å˜æ›´æ—¶å¯èƒ½ä¸å…¼å®¹

---

## ğŸ® å®é™…ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: ä¿å­˜ç©å®¶ä½ç½®

```
åœºæ™¯ç»“æ„:
player (CharacterBody2D)
â””â”€â”€ SaveDataComponent
    â””â”€â”€ save_data_resource = scene_data_resource.tres

ä»£ç :
SaveGameManager.save_game()  # ä¿å­˜ç©å®¶ä½ç½®
SaveGameManager.load_game()  # æ¢å¤ç©å®¶ä½ç½®
```

### ç¤ºä¾‹2: ä¿å­˜ä½œç‰©çŠ¶æ€

```
åœºæ™¯ç»“æ„:
Corn (Node2D)
â””â”€â”€ SaveDataComponent
    â””â”€â”€ save_data_resource = scene_data_resource.tres

ä»£ç :
# ä½œç‰©è¢«ç§æ¤æ—¶è‡ªåŠ¨ä¿å­˜
SaveGameManager.save_game()
```

### ç¤ºä¾‹3: ä¿å­˜åœ°å›¾çŠ¶æ€

```
åœºæ™¯ç»“æ„:
GameTileMap
â””â”€â”€ Dirt (TileMapLayer)
    â””â”€â”€ SaveDataComponent
        â””â”€â”€ save_data_resource = tilemap_layer_data_resource.tres

ä»£ç :
# è€•åœ°åè‡ªåŠ¨ä¿å­˜
SaveGameManager.save_game()
```

---

## â“ å¦‚ä½•åˆ¤æ–­ç³»ç»Ÿæ˜¯å¦æ­£å¸¸å·¥ä½œ

### æµ‹è¯•ä¿å­˜:
1. è¿è¡Œæ¸¸æˆ
2. è§¦å‘ä¿å­˜ï¼ˆæŒ‰é”®æˆ–ä»£ç ï¼‰
3. æ£€æŸ¥æ§åˆ¶å°è¾“å‡º: `Save result: 0`ï¼ˆ0è¡¨ç¤ºæˆåŠŸï¼‰
4. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ç”Ÿæˆ:
   - Windows: `%APPDATA%/Godot/app_userdata/farm_exercise/game_data/`
   - åº”è¯¥çœ‹åˆ° `save_åœºæ™¯å_game_data.tres`

### æµ‹è¯•åŠ è½½:
1. æ”¹å˜æ¸¸æˆçŠ¶æ€ï¼ˆç§»åŠ¨ç©å®¶ã€ç§æ¤ä½œç‰©ç­‰ï¼‰
2. ä¿å­˜
3. é€€å‡ºæ¸¸æˆ
4. é‡æ–°è¿è¡Œ
5. è§¦å‘åŠ è½½
6. æ£€æŸ¥çŠ¶æ€æ˜¯å¦æ¢å¤

---

## ğŸ†˜ ç´§æ€¥æ’æŸ¥

å¦‚æœå­˜æ¡£ç³»ç»Ÿä¸å·¥ä½œï¼ŒæŒ‰ä»¥ä¸‹é¡ºåºæ£€æŸ¥:

1. **æ£€æŸ¥æ˜¯å¦æœ‰ SaveLevelDataComponent**
   ```gdscript
   # åœ¨ä»£ç ä¸­ä¸´æ—¶æ·»åŠ è°ƒè¯•
   var nodes = get_tree().get_nodes_in_group("save_level_data_manager")
   print("æ‰¾åˆ°çš„ç®¡ç†å™¨æ•°é‡: ", nodes.size())
   ```

2. **æ£€æŸ¥æ˜¯å¦æœ‰ SaveDataComponent**
   ```gdscript
   var nodes = get_tree().get_nodes_in_group("save_data_component")
   print("æ‰¾åˆ°çš„æ•°æ®ç»„ä»¶æ•°é‡: ", nodes.size())
   ```

3. **æ£€æŸ¥æ–‡ä»¶è·¯å¾„**
   ```gdscript
   print("å­˜æ¡£è·¯å¾„: ", SaveLevelDataComponent.save_game_data_path)
   print("å­˜æ¡£æ–‡ä»¶å: ", SaveLevelDataComponent.save_file_name)
   ```

4. **æ£€æŸ¥å­˜æ¡£æ–‡ä»¶å†…å®¹**
   - ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ .tres æ–‡ä»¶
   - æ£€æŸ¥æ˜¯å¦åŒ…å«ä¿å­˜çš„æ•°æ®

---

## ğŸ“ æ€»ç»“

**ä¸¤ä¸ªç»„çš„å…³ç³»**:
- `save_level_data_manager`: æ‰¾åˆ°"å­˜æ¡£ç®¡ç†å‘˜"
- `save_data_component`: æ‰¾åˆ°"æ‰€æœ‰éœ€è¦ä¿å­˜çš„ä¸œè¥¿"

**å·¥ä½œæµç¨‹**:
ç®¡ç†å‘˜ â†’ æ”¶é›†æ‰€æœ‰ä¸œè¥¿ â†’ ä¿å­˜åˆ°æ–‡ä»¶

**ä½¿ç”¨æ­¥éª¤**:
1. åœºæ™¯æ·»åŠ  SaveLevelDataComponent
2. éœ€è¦ä¿å­˜çš„èŠ‚ç‚¹æ·»åŠ  SaveDataComponent
3. è°ƒç”¨ SaveGameManager.save_game() / load_game()

æœ‰ä»»ä½•é—®é¢˜éšæ—¶é—®æˆ‘ï¼
